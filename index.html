<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Tobias J. Aichinger, Moritz V. Gruber, Lukas Sonnleitner">
<link rel="icon" type="image/png" href="themes/favicon.png">
<title>Security: Userverwaltung</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<style>
    pre.rouge .hll {
        background-color: #ffc;
        display: block;
    }
    pre.rouge .hll * {
        background-color: initial;
    }
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Security: Userverwaltung</h1>
<div class="details">
<span id="author" class="author">Tobias J. Aichinger, Moritz V. Gruber, Lukas Sonnleitner</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">2024-12-16</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_authentifizierung_und_autorisierung">1. Authentifizierung und Autorisierung</a></li>
<li><a href="#_rollen">2. Rollen</a></li>
<li><a href="#_standards">3. Standards</a>
<ul class="sectlevel2">
<li><a href="#_oauth_2_0">3.1. OAuth 2.0</a></li>
<li><a href="#_oidc">3.2. OIDC</a></li>
<li><a href="#_saml_2_0">3.3. SAML 2.0</a></li>
<li><a href="#_jwt">3.4. JWT</a></li>
</ul>
</li>
<li><a href="#_keycloak">4. Keycloak</a>
<ul class="sectlevel2">
<li><a href="#_was_ist_keycloak">4.1. Was ist Keycloak?</a></li>
<li><a href="#_alternativen">4.2. Alternativen</a></li>
<li><a href="#_wichtige_bestandteile_in_keycloak">4.3. Wichtige Bestandteile in Keycloak</a></li>
</ul>
</li>
<li><a href="#_keycloak_mit_dem_quarkus_keycloak_admin_rest_client">5. Keycloak mit dem quarkus-keycloak-admin-rest-client</a>
<ul class="sectlevel2">
<li><a href="#_projekterstellung">5.1. Projekterstellung</a></li>
<li><a href="#_keycloak_container_starten">5.2. Keycloak Container starten</a></li>
<li><a href="#_realm_erstellen">5.3. Realm erstellen</a></li>
<li><a href="#_quarkus_client_erstellen">5.4. Quarkus-Client erstellen</a></li>
<li><a href="#_probe">5.5. Probe</a></li>
</ul>
</li>
<li><a href="#_custom_theme">6. Custom Theme</a></li>
<li><a href="#_demo">7. Demo</a></li>
<li><a href="#_reverse_proxies">8. Reverse Proxies</a>
<ul class="sectlevel2">
<li><a href="#_was_ist_ein_reverse_proxy">8.1. Was ist ein Reverse Proxy?</a></li>
<li><a href="#_warum_braucht_man_einen_reverse_proxy">8.2. Warum braucht man einen Reverse Proxy?</a></li>
<li><a href="#_reverse_proxies_im_überblick">8.3. Reverse Proxies im Überblick</a></li>
<li><a href="#_tls_warum_brauch_i_sowas">8.4. TLS? Warum brauch i sowas.</a></li>
</ul>
</li>
<li><a href="#_quellen">9. Quellen</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Security</strong> ist in der IT ein Begriff, der unzählige Bereiche abdeckt. Diese Dokumentation widmet sich einerseits der Verwaltung und Sicherung von <strong>Benutzeridentitäten</strong> und <strong>Zugriffsrechten</strong> und andererseits der <strong>Netzwerksicherheit</strong> mit Schwerpunkt auf <strong>Reverse Proxies</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentifizierung_und_autorisierung"><a class="anchor" href="#_authentifizierung_und_autorisierung"></a>1. Authentifizierung und Autorisierung</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Autor: <strong>Moritz V. Gruber</strong></p>
</div>
<div class="paragraph">
<p>Authentifizierung durch Eingabe von Username und Passwort → <strong>Wer bin ich?</strong></p>
</div>
<div class="paragraph">
<p>Durch Rollen ist man autorisiert, auf Ressourcen zuzugreifen → <strong>Was darf ich?</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rollen"><a class="anchor" href="#_rollen"></a>2. Rollen</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="images/roles.png" alt="roles"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standards"><a class="anchor" href="#_standards"></a>3. Standards</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oauth_2_0"><a class="anchor" href="#_oauth_2_0"></a>3.1. OAuth 2.0</h3>
<div class="paragraph">
<p><span class="image"><img src="images/oauth2-logo.png" alt="oauth2 logo" width="200"></span></p>
</div>
<div class="paragraph">
<p><span class="underline">Bezeichnung</span>: O<sub>pen</sub> Auth<sub>orization</sub> 2.0</p>
</div>
<div class="sect3">
<h4 id="_definition"><a class="anchor" href="#_definition"></a>3.1.1. Definition</h4>
<div class="paragraph">
<p><strong>OAuth 2.0</strong> ist ein <strong>Protokoll</strong>, welches für die <strong>Autorisierung</strong> verantwortlich ist. Der Vorgänger <strong>0Auth 1.0</strong> wurde ausschließlich für Webseiten entwickelt und wird nicht mehr häufig verwendet.</p>
</div>
<div class="paragraph">
<p>Mehr Informationen <a href="https://auth0.com/de/intro-to-iam/what-is-oauth-2" target="_blank" rel="noopener">hier</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Die Authentifizierung von Benutzern wird bei OAuth 2.0 <strong>nicht</strong> abgedeckt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/oauth2-authorization-code-flow.png" alt="oauth2 authorization code flow"></span></p>
</div>
<details>
<summary class="title">Erklärung</summary>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Die <span class="green">Applikation</span> fordert vom <span class="red">Browser</span>, dass er den User zu <span class="gray">Keycloak</span> umleitet.</p>
</li>
<li>
<p>Der <span class="red">Browser</span> leitet den User zu <span class="gray">Keycloak</span> um.</p>
</li>
<li>
<p><span class="gray">Keycloak</span> authentifiziert den User, falls er noch nicht mit <span class="gray">Keycloak</span> authentifiziert ist.</p>
</li>
<li>
<p>Die <span class="green">Applikation</span> erhält einen Autorisierungscode von <span class="gray">Keycloak</span>.</p>
</li>
<li>
<p>Die <span class="green">Applikation</span> tauscht diesen Autorisierungscode gegen einen <strong>Access-Token</strong> von <span class="gray">Keycloak</span> ein.</p>
</li>
<li>
<p>Dieser Access-Token kann nun genutzt werden um auf <strong>Ressourcen</strong> auf dem <span class="blue">Service</span> zuzugreifen.</p>
</li>
</ol>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_oidc"><a class="anchor" href="#_oidc"></a>3.2. OIDC</h3>
<div class="paragraph">
<p><span class="image"><img src="images/oidc-logo.png" alt="oidc logo" width="200"></span></p>
</div>
<div class="paragraph">
<p><span class="underline">Bezeichnung</span>: O<sub>pen</sub>ID C<sub>onnect</sub></p>
</div>
<div class="sect3">
<h4 id="_definition_2"><a class="anchor" href="#_definition_2"></a>3.2.1. Definition</h4>
<div class="paragraph">
<p><strong>OIDC</strong> ist ein <strong>Protokoll</strong>, welches auf 0Auth 2.0 aufbaut und eine zusätzliche Schicht für die <strong>Authentifizierung</strong> hinzufügt.</p>
</div>
<div class="paragraph">
<p>Mehr Informationen <a href="https://auth0.com/de/intro-to-iam/what-is-openid-connect-oidc" target="_blank" rel="noopener">hier</a>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/oidc-authorization-code-flow.png" alt="oidc authorization code flow"></span></p>
</div>
<details>
<summary class="title">Erklärung</summary>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Die <span class="green">Applikation</span> fordert vom <span class="red">Browser</span>, dass er den User zu <span class="gray">Keycloak</span> umleitet.</p>
</li>
<li>
<p>Der <span class="red">Browser</span> leitet den User zu <span class="gray">Keycloak</span> um.</p>
</li>
<li>
<p><span class="gray">Keycloak</span> authentifiziert den User, falls er noch nicht mit <span class="gray">Keycloak</span> authentifiziert ist.</p>
</li>
<li>
<p>Die <span class="green">Applikation</span> erhält einen Autorisierungscode von <span class="gray">Keycloak</span>.</p>
</li>
<li>
<p>Die <span class="green">Applikation</span> tauscht diesen Autorisierungscode gegen einen <strong>ID-Token</strong> und einen <strong>Access-Token</strong> von <span class="gray">Keycloak</span> ein.</p>
</li>
<li>
<p>Die <span class="green">Applikation</span> verfügt nun über den ID-Token, mit dem sie die Identität des Benutzers ermitteln und eine authentifizierte Sitzung für den User aufbauen kann.</p>
</li>
</ol>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_saml_2_0"><a class="anchor" href="#_saml_2_0"></a>3.3. SAML 2.0</h3>
<div class="paragraph">
<p><span class="image"><img src="images/saml-logo.png" alt="saml logo" width="200"></span></p>
</div>
<div class="paragraph">
<p><span class="underline">Bezeichnung</span>: S<sub>ecurity</sub> A<sub>ssertion</sub> M<sub>arkup</sub> L<sub>anguage</sub> 2.0</p>
</div>
<div class="sect3">
<h4 id="_definition_3"><a class="anchor" href="#_definition_3"></a>3.3.1. Definition</h4>
<div class="paragraph">
<p><strong>SAML 2.0</strong> ist ein XML-basiertes Standardprotokoll für Authentifizierung und Autorisierung. Es wird häufig verwendet, um Single Sign-On in Unternehmens- und Regierungsanwendungen zu ermöglichen. Das Protokoll ermöglicht es bestehenden Benutzern sich schnell und einfach in neuen Anwendungen zu authentifizieren.</p>
</div>
<div class="paragraph">
<p>Mehr Informationen <a href="https://auth0.com/de/intro-to-iam/what-is-saml" target="_blank" rel="noopener">hier</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jwt"><a class="anchor" href="#_jwt"></a>3.4. JWT</h3>
<div class="paragraph">
<p><span class="image"><img src="images/jwt-logo.svg" alt="jwt logo" width="200"></span></p>
</div>
<div class="paragraph">
<p><span class="underline">Bezeichnung</span>: J<sub>son</sub> W<sub>eb</sub> T<sub>oken</sub></p>
</div>
<div class="sect3">
<h4 id="_definition_4"><a class="anchor" href="#_definition_4"></a>3.4.1. Definition</h4>
<div class="paragraph">
<p><strong>JSON Web Token</strong> ist ein offener Standard, der eine kompakte Möglichkeit zur sicheren Übertragung von Informationen zwischen Parteien als JSON-Objekt definiert. Diese Information wird digital <strong>signiert</strong> und ist somit vertrauenswürdig.</p>
</div>
</div>
<div class="sect3">
<h4 id="_struktur"><a class="anchor" href="#_struktur"></a>3.4.2. Struktur</h4>
<div class="paragraph">
<p>Ein JWT setzt sich aus 3 Teilen zusammen, welche jeweils durch einen <code>.</code> getrennt werden: <code>xxxxx.yyyyy.zzzzz</code></p>
</div>
<div class="sect4">
<h5 id="_header_xxxxx_yyyyy_zzzzz"><a class="anchor" href="#_header_xxxxx_yyyyy_zzzzz"></a>Header: (<code>XXXXX</code>.yyyyy.zzzzz)</h5>
<div class="paragraph">
<p>Besteht aus 2 Teilen:</p>
</div>
<div class="listingblock">
<div class="title">Beispiel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HS256"</span><span class="p">,</span><span class="w"> <i class="conum" data-value="1"></i><b>(1)</b>
  </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JWT"</span><span class="w"> <i class="conum" data-value="2"></i><b>(2)</b>
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Verwendeter Signieralgorithmus: <a href="https://stackoverflow.com/questions/39239051/rs256-vs-hs256-whats-the-difference" target="_blank" rel="noopener">Unterschied zwischen <strong>HS256</strong> und <strong>RS256</strong></a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Typ des Tokens</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dieses JSON wird <strong>Base64</strong> verschlüsselt und macht somit den <strong>ersten</strong> Teil des JWTs aus.</p>
</div>
</div>
<div class="sect4">
<h5 id="_payload_xxxxx_yyyyy_zzzzz"><a class="anchor" href="#_payload_xxxxx_yyyyy_zzzzz"></a>Payload: (xxxxx.<code>YYYYY</code>.zzzzz)</h5>
<div class="paragraph">
<p>Die Payload enthält die Claims. <strong>Claims</strong> sind meistens Daten über den User und zusätzliche Daten. Es gibt 3 Arten von Claims:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Registered</strong> Claims: Vordefinierte Claims wie z. B. <code>exp</code> (expiration time) und noch <a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1" target="_blank" rel="noopener">mehr</a></p>
</li>
<li>
<p><strong>Public</strong> Claims: Sind eigens <strong>benutzerdefinierte</strong> Claims, welche öffentlich registriert werden. Dabei ist es wichtig darauf zu achten, dass keine Namenskonflikte entstehen.</p>
</li>
<li>
<p><strong>Private</strong> Claims: Sind eigens <strong>benutzerdefinierte</strong> Claims, welche nicht veröffentlicht werden.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Beispiel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"exp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1734137921"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"admin"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dieses JSON wird <strong>Base64</strong> verschlüsselt und macht somit den <strong>zweiten</strong> Teil des JWTs aus.</p>
</div>
</div>
<div class="sect4">
<h5 id="_signature_xxxxx_yyyyy_zzzzz"><a class="anchor" href="#_signature_xxxxx_yyyyy_zzzzz"></a>Signature: (xxxxx.yyyyy.<code>ZZZZZ</code>)</h5>
<div class="paragraph">
<p>Im dritten Part wird der <code>Header</code>, die <code>Payload</code> und ein <code>Secret</code> mit den im Header angegebenen Signieralgorithmus signiert.</p>
</div>
<div class="listingblock">
<div class="title">Beispiel für HS256</div>
<div class="content">
<pre class="rouge highlight"><code>HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Signatur kann sicherstellen, dass die Nachricht nicht von Dritten geändert wurde. Dies macht den <strong>dritten</strong> Teil des JWTs aus.</p>
</div>
</div>
<div class="sect4">
<h5 id="_zusammenfassung"><a class="anchor" href="#_zusammenfassung"></a>Zusammenfassung:</h5>
<div class="paragraph">
<p>Das Ergebnis sind <strong>3</strong> <strong>Base64</strong> Strings, welche durch einen <code>.</code> separiert werden.</p>
</div>
<div class="paragraph">
<p>Mehr Informationen <a href="https://jwt.io/introduction" target="_blank" rel="noopener">hier</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak"><a class="anchor" href="#_keycloak"></a>4. Keycloak</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_was_ist_keycloak"><a class="anchor" href="#_was_ist_keycloak"></a>4.1. Was ist Keycloak?</h3>
<div class="paragraph">
<p>Keycloak ist eine <strong>Open-Source</strong>-Identity- und Access-Management-Lösung, die Funktionen wie Single Sign-On (SSO), Benutzerverwaltung und Social Login bietet.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>Single Sign-On</strong> ist ein Authentifizierungsverfahren, bei dem Benutzer sich nur einmal anmelden und anschließend auf mehrere Anwendungen oder Systeme zugreifen können, ohne sich erneut authentifizieren zu müssen.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_alternativen"><a class="anchor" href="#_alternativen"></a>4.2. Alternativen</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-middle"><a href="https://www.keycloak.org/" target="_blank" rel="noopener">Keycloak</a></th>
<th class="tableblock halign-center valign-middle"><a href="https://auth0.com/" target="_blank" rel="noopener">Auth0</a></th>
<th class="tableblock halign-center valign-middle"><a href="https://www.authelia.com/" target="_blank" rel="noopener">Authelia</a></th>
<th class="tableblock halign-center valign-middle"><a href="https://goauthentik.io/" target="_blank" rel="noopener">authentik</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>Open Source</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🔴</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>Protocol Support:</strong> OAuth 2.0 und OIDC</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>Protocol Support:</strong> SAML 2.0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🔴</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>Language</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/java-logo.png" alt="java logo" width="40" height="40"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">404</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/go-logo.png" alt="go logo" width="40" height="40"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/python-logo.png" alt="python logo" width="40" height="40"></span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_wichtige_bestandteile_in_keycloak"><a class="anchor" href="#_wichtige_bestandteile_in_keycloak"></a>4.3. Wichtige Bestandteile in Keycloak</h3>
<div class="sect3">
<h4 id="_realms"><a class="anchor" href="#_realms"></a>4.3.1. Realms</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <strong>realm</strong> manages a set of users, credentials, roles, and groups. A user belongs to and logs into a realm. Realms are isolated from one another and can only manage and authenticate the users that they control.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>realm description</cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_clients"><a class="anchor" href="#_clients"></a>4.3.2. Clients</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Clients</strong> are applications and services that can request authentication of a user.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>client description</cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_realm_roles"><a class="anchor" href="#_realm_roles"></a>4.3.3. Realm roles</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Realm roles</strong> are the roles that you define for use in the current realm.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>realm role description</cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_users"><a class="anchor" href="#_users"></a>4.3.4. Users</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Users</strong> are the users in the current realm.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>user description</cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_groups"><a class="anchor" href="#_groups"></a>4.3.5. Groups</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>A <strong>group</strong> is a set of attributes and role mappings that can be applied to a user.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>group description</cite>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sessions"><a class="anchor" href="#_sessions"></a>4.3.6. Sessions</h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Sessions</strong> are sessions of users in this realm and the clients that they access within the session.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Keycloak<br>
<cite>session description</cite>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak_mit_dem_quarkus_keycloak_admin_rest_client"><a class="anchor" href="#_keycloak_mit_dem_quarkus_keycloak_admin_rest_client"></a>5. Keycloak mit dem quarkus-keycloak-admin-rest-client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Für die Kommunikation zwischen der <strong>Quarkus-Applikation</strong> und <strong>Keycloak</strong> wird die <a href="https://quarkus.io/guides/security-keycloak-admin-client" target="_blank" rel="noopener">quarkus-keycloak-admin-rest-client</a> dependency verwendet. Der Rest-Client sendet Requests an die <a href="https://www.keycloak.org/docs-api/latest/rest-api/index.html" target="_blank" rel="noopener"><code>Keycloak Admin REST API</code></a>.</p>
</div>
<div class="sect2">
<h3 id="_projekterstellung"><a class="anchor" href="#_projekterstellung"></a>5.1. Projekterstellung</h3>
<div class="listingblock">
<div class="title">Projekterstellung mit Quarkus CLI</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">quarkus create app at.htl:security-keycloak-admin-client <span class="se">\</span>
    <span class="nt">--extension</span><span class="o">=</span><span class="s1">'keycloak-admin-rest-client,rest-jackson'</span> <span class="se">\</span>
    <span class="nt">--no-code</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Projekterstellung mit Maven CLI</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">mvn io.quarkus.platform:quarkus-maven-plugin:3.17.3:create <span class="se">\</span>
    <span class="nt">-DprojectGroupId</span><span class="o">=</span>at.htl <span class="se">\</span>
    <span class="nt">-DprojectArtifactId</span><span class="o">=</span>security-keycloak-admin-client <span class="se">\</span>
    <span class="nt">-Dextensions</span><span class="o">=</span><span class="s1">'keycloak-admin-rest-client,rest-jackson'</span> <span class="se">\</span>
    <span class="nt">-DnoCode</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Dependencies aus pom.xml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>quarkus-keycloak-admin-rest-client<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>quarkus-rest-jackson<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.quarkus<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>quarkus-arc<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keycloak_container_starten"><a class="anchor" href="#_keycloak_container_starten"></a>5.2. Keycloak Container starten</h3>
<div class="ulist">
<ul>
<li>
<p><code>keycloak</code> Ordner auf der Ebene des Quarkus-Projekts erstellen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">mkdir </span>keycloak</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Im <code>keycloak</code> Ordner eine Datei namens <code>docker-compose.yml</code> erstellen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="nb">cd </span>keycloak
<span class="nb">touch </span>docker-compose.yml</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Das <code>docker-compose.yml</code> mit folgendem Code befüllen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">keycloak</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">keycloak-demo</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="na">build</span><span class="pi">:</span> <i class="conum" data-value="2"></i><b>(2)</b>
      <span class="na">context</span><span class="pi">:</span> <span class="s">.</span>
      <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">Dockerfile</span>
    <span class="na">environment</span><span class="pi">:</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="pi">-</span> <span class="s">KEYCLOAK_ADMIN=admin</span>
      <span class="pi">-</span> <span class="s">KEYCLOAK_ADMIN_PASSWORD=admin</span>

      <span class="pi">-</span> <span class="s">KC_HOSTNAME_STRICT=false</span>
      <span class="pi">-</span> <span class="s">KC_HTTP_ENABLED=true</span>
      <span class="pi">-</span> <span class="s">KC_HOSTNAME=localhost</span>

      <span class="pi">-</span> <span class="s">KC_DB=postgres</span>
      <span class="pi">-</span> <span class="s">KC_DB_URL=jdbc:postgresql://keycloak-db/db</span>
      <span class="pi">-</span> <span class="s">KC_DB_USERNAME=app</span>
      <span class="pi">-</span> <span class="s">KC_DB_PASSWORD=app</span>

      <span class="pi">-</span> <span class="s">KC_HEALTH_ENABLED=true</span>
      <span class="pi">-</span> <span class="s">KC_METRICS_ENABLED=true</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">start-dev"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">--import-realm"</span><span class="pi">]</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./import:/opt/keycloak/data/import</span> <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="pi">-</span> <span class="s">./themes:/opt/keycloak/themes/</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:8080"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">keycloak-db</span>

  <span class="na">keycloak-db</span><span class="pi">:</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">keycloak-db</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:17.2</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">POSTGRES_USER=app</span>
      <span class="pi">-</span> <span class="s">POSTGRES_PASSWORD=app</span>
      <span class="pi">-</span> <span class="s">POSTGRES_DB=db</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./keycloak-db/data:/var/lib/postgresql/data</span></code></pre>
</div>
</div>
<details>
<summary class="title">Erklärung</summary>
<div class="content">
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Der Name des Containers</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Für den Bauvorgang wird ein <code>Dockerfile</code> verwendet</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://www.keycloak.org/server/all-config" target="_blank" rel="noopener">Konfiguration in Keycloak</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>start-dev</code> um Keycloak Modus starten und <code>--import-realm</code> um einen Realm zu importieren</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Bind mount für eine Realm-JSON Datei</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Bind mount für ein eigenes Theme</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Service für eine Datenbank</td>
</tr>
</table>
</div>
</div>
</details>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="dockerfile"><span class="k">FROM</span><span class="w"> </span><span class="s">quay.io/keycloak/keycloak:26.0.2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">RUN </span>/opt/keycloak/bin/kc.sh build

<span class="k">FROM</span><span class="s"> quay.io/keycloak/keycloak:26.0.2 </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">COPY</span><span class="s"> --from=builder /opt/keycloak/ /opt/keycloak/</span></code></pre>
</div>
</div>
<details>
<summary class="title">Erklärung</summary>
<div class="content">
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Es wird die Version <code>26.0.2</code> verwendet, da die neuste Version (<code>26.0.7</code>) Änderungen enthält, welche die <strong>keycloak-admin-rest-client</strong> dependency in Quarkus noch nicht umgesetzt hat. (Stand: 2024-12-15)</td>
</tr>
</table>
</div>
</div>
</details>
<div class="ulist">
<ul>
<li>
<p>Den Container mit folgendem Befehl starten</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">docker compose up</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Nun kann auf <code><a href="http://localhost:8000" class="bare">http://localhost:8000</a></code>, auf den laufenden Keycloak Container zugegriffen werden. In der Anmeldemaske kann man sich mithilfe der im <code>docker-compose.yml</code> angegebenen Username und Passwort als Admin anmelden.</p>
</li>
</ul>
</div>
<details>
<summary class="title">Anmeldemaske</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-admin-login.png" alt="keycloak admin login">
</div>
</div>
</div>
</details>
<details>
<summary class="title">Admin-Konsole</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-admin-console.png" alt="keycloak admin console">
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_realm_erstellen"><a class="anchor" href="#_realm_erstellen"></a>5.3. Realm erstellen</h3>
<div class="paragraph">
<p>Um einen <strong>Realm</strong> zu erstellen, muss man im linken oberen Eck auf das Dropdown und anschließend auf den Button <code>Create realm</code> klicken.</p>
</div>
<details>
<summary class="title">Realm erstellen Button</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-create-realm-button.png" alt="keycloak create realm button">
</div>
</div>
</div>
</details>
<div class="ulist">
<ul>
<li>
<p>Namen vergeben (z. B. my-realm)</p>
</li>
<li>
<p><code>Enabled</code> Option auf <code>On</code> lassen</p>
</li>
<li>
<p>Auf den <code>Create</code> Button klicken</p>
</li>
</ul>
</div>
<details>
<summary class="title">Realm erstellen</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-create-realm-window.png" alt="keycloak create realm window">
</div>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_quarkus_client_erstellen"><a class="anchor" href="#_quarkus_client_erstellen"></a>5.4. Quarkus-Client erstellen</h3>
<div class="paragraph">
<p>Um einen <strong>Client</strong> zu erstellen, muss man im Clients Tab auf den <code>Create client</code> Button klicken.</p>
</div>
<details>
<summary class="title">Client erstellen</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-create-client-button.png" alt="keycloak create client button">
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>General Settings</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Als <code>Client ID</code> wird in diesem Beispiel der Name <code>quarkus-client</code> gewählt</p>
</li>
<li>
<p>Name und Description sind optional</p>
</li>
<li>
<p><code>Always display in UI</code> auf <code>On</code>, um Client dauerhaft im UI anzuzeigen</p>
</li>
</ul>
</div>
<details>
<summary class="title">Client erstellen - General Settings</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-create-client-general-settings.png" alt="keycloak create client general settings">
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>Capability config</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Client Authentication</code> auf <code>On</code></p>
</li>
<li>
<p><code>Authorization</code> auf <code>On</code></p>
</li>
<li>
<p><code>Authentication flow</code> (TODO)</p>
<div class="ulist">
<ul>
<li>
<p>Standard flow</p>
</li>
<li>
<p><span class="line-through">Implicit flow</span>: deprecated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<details>
<summary class="title">Client erstellen - Capability config</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/keycloak-create-client-capability-config.png" alt="keycloak create client capability config">
</div>
</div>
</div>
</details>
<div class="paragraph">
<p><strong>Login settings</strong></p>
</div>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="_probe"><a class="anchor" href="#_probe"></a>5.5. Probe</h3>
<div class="paragraph">
<p>Nachdem nun ein <strong>Realm</strong> und ein <strong>Client</strong> in Keycloak existieren, können wir den <strong>keycloak-admin-rest-client</strong> ausprobieren.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="c"># Quarkus keycloak-admin-client
</span><span class="py">quarkus.keycloak.admin-client.enabled</span><span class="p">=</span><span class="s">true </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">quarkus.keycloak.admin-client.server-url</span><span class="p">=</span><span class="s">http://localhost:8000 </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="py">quarkus.keycloak.admin-client.realm</span><span class="p">=</span><span class="s">my-realm </span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="py">quarkus.keycloak.admin-client.client-id</span><span class="p">=</span><span class="s">quarkus-client </span><i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>true, wenn injection von Keycloak-Admin-Client unterstützt werden soll</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Die URL des Keycloak-Servers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Der Name des Realms, worin sich der Client befindet</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Der Name des erstellten Clients</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Beispiels-Endpunkt</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">package</span> <span class="nn">at.htl.keycloakDemo.resources</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.inject.Inject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.ws.rs.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.ws.rs.core.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.keycloak.admin.client.Keycloak</span><span class="o">;</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">"/admin"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RolesResource</span> <span class="o">{</span>
    <span class="nd">@Inject</span>
    <span class="nc">Keycloak</span> <span class="n">keycloak</span><span class="o">;</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">"/roles"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Response</span> <span class="nf">getRoles</span><span class="o">()</span> <span class="o">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">return</span> <span class="nc">Response</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span>
            <span class="n">keycloak</span>
                <span class="o">.</span><span class="na">realm</span><span class="o">(</span><span class="s">"my-realm"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">roles</span><span class="o">()</span>
                <span class="o">.</span><span class="na">list</span><span class="o">()</span>
        <span class="o">).</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ein Keycloak-Objekt wird injiziert.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Endpunkt um alle Rollen des Realms <code>my-realm</code> zu bekommen.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_response"><a class="anchor" href="#_response"></a>5.5.1. Response</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Error id bc6db0c5-e662-4e91-80e2-48e50026eb69-6, org.jboss.resteasy.reactive.ClientWebApplicationException: Received: 'Server response is: 401' when invoking REST Client method: 'org.keycloak.admin.client.token.TokenService#grantToken'"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Der Keycloak-Server gibt eine <strong>401 - Unauthorized</strong> Response zurück. Um dies zu beheben, müssen wir unsere <strong>Quarkus-Applikation</strong> mit dem Keycloak authentifizieren.</p>
</div>
</div>
<div class="sect3">
<h4 id="_authentifizierung"><a class="anchor" href="#_authentifizierung"></a>5.5.2. Authentifizierung</h4>
<div class="paragraph">
<p>Es gibt 2 Möglichkeiten zur Authentifizierung mit dem <strong>keycloak-admin-client</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Grant type: password</p>
</li>
<li>
<p>Grant type: client-credentials</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Ein <strong>grant type</strong> bezeichnet die Art und Weise wie ein Client sich mit Keycloak authentifiziert.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_grant_type_password"><a class="anchor" href="#_grant_type_password"></a>Grant type: password</h5>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="c"># Quarkus keycloak-admin-client
</span><span class="py">quarkus.keycloak.admin-client.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">quarkus.keycloak.admin-client.server-url</span><span class="p">=</span><span class="s">http://localhost:8000</span>
<span class="py">quarkus.keycloak.admin-client.realm</span><span class="p">=</span><span class="s">my-realm</span>
<span class="py">quarkus.keycloak.admin-client.client-id</span><span class="p">=</span><span class="s">admin-cli </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">quarkus.keycloak.admin-client.grant-type</span><span class="p">=</span><span class="s">password </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="py">quarkus.keycloak.admin-client.username</span><span class="p">=</span><span class="s">alice </span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="py">quarkus.keycloak.admin-client.password</span><span class="p">=</span><span class="s">alice </span><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Für die <code>password</code> Variante muss die <strong>client-id</strong> auf <code>admin-cli</code> geändert werden. Dieser Admin-Client ist ein default client, auf welchem die <strong>Client authentication</strong> und <strong>Authorization</strong> ausgeschaltet sind. Allerdings brauchen wir diese bei dieser Variante nicht. TODO: überprüfen</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setzt den <strong>grant-type</strong> auf <code>password</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Username und Passwort des erstellten Users.</td>
</tr>
</table>
</div>
<details>
<summary class="title">User erstellen</summary>
<div class="content">
<div class="paragraph">
<p>Im erstellten Realm auf <code>Users</code> &#8594; <code>Add user</code> klicken.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Obwohl nur <strong>Username</strong> ein Pflichtfeld ist, müssen auch <strong>Email</strong>, <strong>First name</strong> und <strong>Last name</strong> ausgefüllt werden. Anderenfalls gibt Keycloak bei sämtlichen Requests einen <strong>400 - Bad Request</strong> zurück.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-add-user.png" alt="keycloak add user"></span></p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_grant_type_client_credentials"><a class="anchor" href="#_grant_type_client_credentials"></a>Grant type: client-credentials</h5>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="c"># Quarkus keycloak-admin-client
</span><span class="py">quarkus.keycloak.admin-client.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">quarkus.keycloak.admin-client.server-url</span><span class="p">=</span><span class="s">http://localhost:8000</span>
<span class="py">quarkus.keycloak.admin-client.realm</span><span class="p">=</span><span class="s">my-realm</span>
<span class="py">quarkus.keycloak.admin-client.client-id</span><span class="p">=</span><span class="s">quarkus-client</span>
<span class="py">quarkus.keycloak.admin-client.grant-type</span><span class="p">=</span><span class="s">client-credentials </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">quarkus.keycloak.admin-client.client-secret</span><span class="p">=</span><span class="s">&lt;secret&gt; </span><i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Legt fest, wie die Quarkus-Anwendung Zugangstokens von Keycloak erhält, um administrative Aufgaben auszuführen. Hier wird der <code>client-credentials</code> type gemeinsam mit den <strong>client-secret</strong> benutzt.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Der <code>client-secret</code> des erstellten Clients. Dieser ist unter folgendem Pfad zu finden: <code>Clients</code> &#8594; <code>&lt;client-name&gt;</code> &#8594; <code>Credentials</code> &#8594; <code>Client Secret</code></td>
</tr>
</table>
</div>
<details>
<summary class="title">Client secret</summary>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-client-secret.png" alt="keycloak client secret"></span></p>
</div>
</div>
</details>
<div class="paragraph">
<p>Jetzt probieren wir denselben Endpunkt nochmals aus.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_response_2"><a class="anchor" href="#_response_2"></a>5.5.3. Response</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Error id bc6db0c5-e662-4e91-80e2-48e50026eb69-5, org.jboss.resteasy.reactive.ClientWebApplicationException: Received: 'Server response is: 403' when invoking REST Client method: 'org.keycloak.admin.client.resource.RolesResource#list'"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Diesmal bekommen wir vom Keycloak-Server eine <strong>403 - Forbidden</strong> Response. Wir sind nun authentifiziert, allerdings ist der <strong>quarkus-client</strong> bzw. der User <strong>alice</strong> nicht autorisiert alle Rollen anzuzeigen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_autorisierung"><a class="anchor" href="#_autorisierung"></a>5.5.4. Autorisierung</h4>
<div class="sect4">
<h5 id="_grant_type_password_2"><a class="anchor" href="#_grant_type_password_2"></a>Grant type: password</h5>
<div class="paragraph">
<p>Unter <code>Users</code> &#8594; <code>&lt;username&gt;</code> &#8594; <code>Role mapping</code> &#8594; <code>Assign role</code> können dem User Rollen zugewiesen werden. Wir weisen dem User die Rolle <code>view-realm</code> zu, um <strong>lesenden</strong> Zugriff auf den <strong>Realm</strong> zu bekommen.</p>
</div>
<details>
<summary class="title">User roles</summary>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-user-roles.png" alt="keycloak user roles"></span>]</p>
</div>
</div>
</details>
</div>
<div class="sect4">
<h5 id="_grant_type_client_credentials_2"><a class="anchor" href="#_grant_type_client_credentials_2"></a>Grant type: client-credentials</h5>
<div class="paragraph">
<p>Unter <code>Clients</code> &#8594; <code>&lt;client-name&gt;</code> &#8594; <code>Service accounts roles</code> &#8594; <code>Assign role</code> können dem Client Rollen zugewiesen werden. Wir weisen dem Client die Rolle <code>view-realm</code> zu, um <strong>lesenden</strong> Zugriff auf den <strong>Realm</strong> zu bekommen.</p>
</div>
<details>
<summary class="title">Client roles</summary>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-client-roles.png" alt="keycloak client roles"></span>]</p>
</div>
</div>
</details>
</div>
</div>
<div class="sect3">
<h4 id="_response_3"><a class="anchor" href="#_response_3"></a>5.5.5. Response</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1a6cc8e5-87ee-4871-a946-23f406bacea1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uma_authorization"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${role_uma_authorization}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scopeParamRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composite"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composites"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clientRole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"containerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a22e79d4-1c88-4ce2-87a2-4757186910c1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6f822b0e-6db4-454d-a205-84f0bcd08aeb"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"offline_access"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${role_offline-access}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scopeParamRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composite"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composites"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clientRole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"containerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a22e79d4-1c88-4ce2-87a2-4757186910c1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"27fd8fbd-7bdf-4b5e-ad05-340a49c2c2f4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"default-roles-my-realm"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${role_default-roles}"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scopeParamRequired"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composite"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"composites"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clientRole"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"containerId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a22e79d4-1c88-4ce2-87a2-4757186910c1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Jetzt werden die 3 default <strong>Realm roles</strong> als Response geliefert.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Falls man Zugriffsrechte, für zum Beispiel das Kreieren von Realms benötigt muss man in den <code>application.properties</code> den Realm <code>master</code> angeben. In diesem gibt es zusätzliche Rollen, wie <code>Create realm</code> oder auch <code>admin</code> um die Realms zu verwalten.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_theme"><a class="anchor" href="#_custom_theme"></a>6. Custom Theme</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keycloak bietet eine Möglichkeit <strong>custom Themes</strong> in Form von <strong>css</strong> zu verwenden. Dafür benötigt man eine Datei namens <code>theme.properties</code> und natürlich ein <code>styles.css</code>.</p>
</div>
<div class="listingblock">
<div class="title">theme.properties</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="properties"><span class="py">parent</span><span class="p">=</span><span class="s">keycloak </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="py">import</span><span class="p">=</span><span class="s">common/keycloak </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="py">styles</span><span class="p">=</span><span class="s">css/login.css css/styles.css </span><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Das parent theme auf dem das custom Theme aufbaut</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mit dem <code>import</code> können common Ressourcen importiert werden</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Alle hier angegeben Stylesheets werden für das custom Theme angewandt</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">styles.css</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="css"><span class="nt">h1</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Um dieses Theme nun in Keycloak verwenden zu können müssen wir eine spezifische Ordnerstruktur neben unserem <code>docker-compose.yml</code> anlegen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/custom-theme-folder-structure.png" alt="custom theme folder structure"></span></p>
</div>
<div class="paragraph">
<p>Nun müssen wir noch einen bind mount anlegen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">keycloak</span><span class="pi">:</span>
    <span class="c1"># ...</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./themes:/opt/keycloak/themes/</span>
    <span class="c1"># ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Nachdem man den Keycloak startet, kann man unter <code>&lt;realm-name&gt;</code> &#8594; <code>Realm settings</code> &#8594; <code>Themes</code> sein eigenes Theme auswählen.</p>
</div>
<details>
<summary class="title">Vorher</summary>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-v2-theme.png" alt="keycloak v2 theme"></span></p>
</div>
</div>
</details>
<details>
<summary class="title">Nachher</summary>
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="images/keycloak-custom-theme.png" alt="keycloak custom theme"></span></p>
</div>
</div>
</details>
<div class="paragraph">
<p>Mehr zu custom Themes <a href="https://www.keycloak.org/docs/latest/server_development/#_themes" target="_blank" rel="noopener">hier</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_demo"><a class="anchor" href="#_demo"></a>7. Demo</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_reverse_proxies"><a class="anchor" href="#_reverse_proxies"></a>8. Reverse Proxies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Autor: <strong>Lukas Sonnleitner</strong></p>
</div>
<div class="sect2">
<h3 id="_was_ist_ein_reverse_proxy"><a class="anchor" href="#_was_ist_ein_reverse_proxy"></a>8.1. Was ist ein Reverse Proxy?</h3>
<div class="paragraph">
<p>Ein Reverse Proxy ist ein Server, der die Anfragen von Clients zu einem oder mehreren Servern weiterleitet.<br>
Ein Reverse Proxy ist stellvertetend für die Server.<br>
Ein Proxy ist stellvertretend für die Clients.</p>
</div>
<div class="paragraph">
<div class="title">Reverse Proxy</div>
<p><span class="image"><img src="images/reverse-proxy.svg" alt="reverse proxy"></span></p>
</div>
<div class="paragraph">
<div class="title">Proxy</div>
<p><span class="image"><img src="images/proxy.svg" alt="proxy"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_warum_braucht_man_einen_reverse_proxy"><a class="anchor" href="#_warum_braucht_man_einen_reverse_proxy"></a>8.2. Warum braucht man einen Reverse Proxy?</h3>
<div class="ulist">
<ul>
<li>
<p>Rate Limiting</p>
</li>
<li>
<p>Routing</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Request Validierung</p>
</li>
<li>
<p>Loadbalancing</p>
</li>
<li>
<p>Caching</p>
</li>
<li>
<p>Compression</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_reverse_proxies_im_überblick"><a class="anchor" href="#_reverse_proxies_im_überblick"></a>8.3. Reverse Proxies im Überblick</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top"><a href="https://nginx.org/en/" target="_blank" rel="noopener">Nginx</a></th>
<th class="tableblock halign-left valign-top"><a href="https://traefik.io/" target="_blank" rel="noopener">Traefik</a></th>
<th class="tableblock halign-left valign-top"><a href="https://caddyserver.com/" target="_blank" rel="noopener">Caddy</a></th>
<th class="tableblock halign-left valign-top"><a href="https://github.com/cloudflare/pingora" target="_blank" rel="noopener">Pingora</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benutzerfreundlichkeit</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟡</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🔴</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.conf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.yaml<br>
.toml<br>
docker labels &#8230;&#8203;<br>
<a href="https://doc.traefik.io/traefik/providers/overview/#supported-providers">Alle Configurations Optionen</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caddyfile<br>
.json<br>
API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rust</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS/Https</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuell / Automatisiert mit Certbot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuell / Automatisiert mit Certbot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatisiert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manuell</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes 😈</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟢</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟡 <a href="https://github.com/caddyserver/ingress">WIP</a></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">🟡 <a href="https://github.com/cloudflare/pingora/issues/41">Issue</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Language</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/c-logo.png" alt="c logo" width="40" height="40"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/go-logo.png" alt="go logo" width="40" height="40"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/go-logo.png" alt="go logo" width="40" height="40"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="images/rust-logo.png" alt="rust logo" width="40" height="40"></span></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_nginx_beispiel"><a class="anchor" href="#_nginx_beispiel"></a>8.3.1. Nginx Beispiel</h4>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">80:80</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./conf.d:/etc/nginx/conf.d:ro</span>
      <span class="pi">-</span> <span class="s">./nginx.conf:/etc/nginx/nginx.conf:ro</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="na">nginx-echo</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nodstuff/gecho:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">conf.d/reverse-proxy.conf</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="conf"><span class="n">server</span> {
    <span class="n">listen</span> <span class="m">80</span>; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="n">server_name</span> <span class="n">localhost</span>; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="n">location</span> /<span class="n">some</span>-<span class="n">path</span>/ { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">http_host</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Real</span>-<span class="n">IP</span> $<span class="n">remote_addr</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>; <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">nginx</span>-<span class="n">echo</span>:<span class="m">8080</span>/;  <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="c"># Der "/" am Ende ist wichtig. Ohne diesen würden Anfragen auf /some-path/ genau so weitergeleitet werden.
</span>        <span class="c"># z.B. /some-path/i-love-turtles =&gt; /some-path/i-love-turtles
</span>        <span class="c"># Mit dem "/" am Ende würde die Anfrage am Upstream Server so aussehen.
</span>        <span class="c"># z.B. /some-path/i-love-turtles =&gt; /i-love-turtles
</span>    }
}

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">80</span>; <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="n">server_name</span> <span class="n">echo</span>.<span class="n">localhost</span>; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="n">location</span> / { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">http_host</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Real</span>-<span class="n">IP</span> $<span class="n">remote_addr</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>; <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>; <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">nginx</span>-<span class="n">echo</span>:<span class="m">8080</span>; <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Port auf den der Server hört</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Der <code>server_name</code> definiert, für welche Hostnamen dieser Serverblock gilt.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Matched den Pfad und der Anfrage</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Überträgt die Header der ursprünglichen Request an den Upstream-Server</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Leitet Anfragen an den Upstream-Server weiter.</td>
</tr>
</table>
</div>
<details>
<summary class="title">nginx.conf</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="conf"><span class="n">user</span> <span class="n">www</span>-<span class="n">data</span>;
<span class="n">worker_processes</span> <span class="n">auto</span>;
<span class="n">pid</span> /<span class="n">run</span>/<span class="n">nginx</span>.<span class="n">pid</span>;

<span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">modules</span>-<span class="n">enabled</span>/*.<span class="n">conf</span>;

<span class="n">events</span> {
    <span class="n">worker_connections</span> <span class="m">768</span>;
    <span class="c"># multi_accept on;
</span>}

<span class="n">http</span> {

    <span class="c">##
</span>    <span class="c"># Basic Settings
</span>    <span class="c">##
</span>
    <span class="n">sendfile</span> <span class="n">on</span>;
    <span class="n">tcp_nopush</span> <span class="n">on</span>;
    <span class="n">types_hash_max_size</span> <span class="m">2048</span>;

    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">mime</span>.<span class="n">types</span>;
    <span class="n">default_type</span> <span class="n">application</span>/<span class="n">octet</span>-<span class="n">stream</span>;

    <span class="c">##
</span>    <span class="c"># SSL Settings
</span>    <span class="c">##
</span>
    <span class="n">ssl_protocols</span> <span class="n">TLSv1</span> <span class="n">TLSv1</span>.<span class="m">1</span> <span class="n">TLSv1</span>.<span class="m">2</span>; <span class="c"># Dropping SSLv3, ref: POODLE
</span>    <span class="n">ssl_prefer_server_ciphers</span> <span class="n">on</span>;

    <span class="c">##
</span>    <span class="c"># Logging Settings
</span>    <span class="c">##
</span>
    <span class="n">access_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">access</span>.<span class="n">log</span>;
    <span class="n">error_log</span> /<span class="n">var</span>/<span class="n">log</span>/<span class="n">nginx</span>/<span class="n">error</span>.<span class="n">log</span>;

    <span class="c">##
</span>    <span class="c"># Gzip Settings
</span>    <span class="c">##
</span>
    <span class="n">gzip</span> <span class="n">on</span>;

    <span class="c">##
</span>    <span class="c"># Cache Settings
</span>    <span class="c">##
</span>
    <span class="c">##
</span>    <span class="c"># Virtual Host Configs
</span>    <span class="c">##
</span>
    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">conf</span>.<span class="n">d</span>/*.<span class="n">conf</span>;
}</code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_traefik_beispiel"><a class="anchor" href="#_traefik_beispiel"></a>8.3.2. Traefik Beispiel</h4>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">traefik</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">traefik</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">traefik:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">TRAEFIK_API=true</span>
      <span class="pi">-</span> <span class="s">TRAEFIK_API_INSECURE=true</span>
      <span class="pi">-</span> <span class="s">TRAEFIK_PROVIDERS_DOCKER=true</span>
      <span class="pi">-</span> <span class="s">LOG_LEVEL=DEBUG</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/var/run/docker.sock:/var/run/docker.sock</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">80:80</span>
      <span class="pi">-</span> <span class="s">8080:8080</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.traefik.rule=Host(`localhost`)</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="pi">-</span> <span class="s">traefik.http.services.traefik.loadbalancer.server.port=8080</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="na">traefik-echo-1</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nodstuff/gecho:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.echo-1.rule=Host(`localhost`) &amp;&amp; PathPrefix(`/some-path`)</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="pi">-</span> <span class="s">traefik.http.routers.echo-1.middlewares=strip-prefix@docker</span> <i class="conum" data-value="4"></i><b>(4)</b>
      <span class="pi">-</span> <span class="s">traefik.http.middlewares.strip-prefix.stripprefix.prefixes=/some-path</span> <i class="conum" data-value="3"></i><b>(3)</b>
      <span class="pi">-</span> <span class="s">traefik.http.services.echo-1.loadbalancer.server.port=8080</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="na">traefik-echo-2</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nodstuff/gecho:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">8000:8080</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">traefik.http.routers.echo-2.rule=Host(`echo.localhost`)</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="c1"># - traefik.http.services.echo.loadbalancer.server.port=8080</span>
      <span class="c1"># not needed because of traefik automatic service discovery magic</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definiert einen Router welcher aufgrund den definierten Regeln die Request an den Container weiterleitet</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Port auf den der Container hört</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Definiert eine Middleware, die den Prefix /some-path von den Anfragen wegschneidet</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Definert, dass der Router die middleware benutzen soll mit &lt;name&gt;@&lt;provider&gt;<br>
<a href="https://doc.traefik.io/traefik/middlewares/overview/">Mehr dazu</a><br>
<a href="https://doc.traefik.io/traefik/providers/overview/">Providers</a></td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_traefik_alternativ_configuration"><a class="anchor" href="#_traefik_alternativ_configuration"></a>Traefik Alternativ configuration</h5>
<div class="listingblock">
<div class="title">traefik.toml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="pi">[</span><span class="nv">http.middlewares</span><span class="pi">]</span>
<span class="pi">[</span><span class="nv">http.middlewares.strip-prefix.stripPrefix</span><span class="pi">]</span>
<span class="s">prefixes = ["/some-path"]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mit dieser statischen Konfiguration würde der provider statt <strong>docker</strong> &#8594; <strong>file</strong> sein.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_caddy_beispiel"><a class="anchor" href="#_caddy_beispiel"></a>8.3.3. Caddy Beispiel</h4>
<div class="listingblock">
<div class="title">docker-compose.yml</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">services</span><span class="pi">:</span>
  <span class="na">caddy</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">caddy</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">caddy:latest</span>
    <span class="na">cap_add</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">NET_ADMIN</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">./config:/etc/caddy</span>
      <span class="pi">-</span> <span class="s">./data:/data</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">80:80</span>
      <span class="pi">-</span> <span class="s">443:443</span>
      <span class="pi">-</span> <span class="s">443:443/udp</span> <span class="c1"># https://hub.docker.com/_/caddy Linux capabilities</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>

  <span class="na">caddy-echo</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nodstuff/gecho:latest</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">config/Caddyfile</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="Caddyfile">echo.localhost { <i class="conum" data-value="1"></i><b>(1)</b>
	reverse_proxy caddy-echo:8080 <i class="conum" data-value="3"></i><b>(3)</b>
}

localhost { <i class="conum" data-value="1"></i><b>(1)</b>
	handle /some-path*  { <i class="conum" data-value="2"></i><b>(2)</b>
		uri strip_prefix /some-path <i class="conum" data-value="4"></i><b>(4)</b>
		reverse_proxy caddy-echo:8080 <i class="conum" data-value="3"></i><b>(3)</b>
	}
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Definieren die Domains oder Hostnamen, die von diesem Block verarbeitet werden.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Matched den Pfad der Anfrage</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Leitet die Anfrage an den Upstream-Server weiter</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Schneidet den Prefix /some-path von dem Pfad der Anfrage weg</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Caddy ist der einzige der 3 welcher automatisch TLS Zertifikate erstellt.
In dieser Demo sind diese selber signiert also nicht von einer Cerfificate Authority ausgestellt.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tls_warum_brauch_i_sowas"><a class="anchor" href="#_tls_warum_brauch_i_sowas"></a>8.4. TLS? Warum brauch i sowas.</h3>
<div class="paragraph">
<p>TLS oder auch *T*ransport *L*ayer *S*ecurity ist ein Verschlüsselungsprotokoll zur sicheren Datenübertragung im Internet.<br>
<a href="https://tls13.xargs.org/#open-all">Wie funktioniert der genau?</a></p>
</div>
<div class="sect3">
<h4 id="_wie_bekomme_ich_so_ein_zertifikat"><a class="anchor" href="#_wie_bekomme_ich_so_ein_zertifikat"></a>8.4.1. Wie bekomme ich so ein Zertifikat?</h4>
<div class="paragraph">
<p>Ganz einfach. Selber machen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openssl genrsa <span class="nt">-out</span> private.key 4096 <i class="conum" data-value="1"></i><b>(1)</b>
openssl req <span class="nt">-new</span> <span class="nt">-key</span> private.key <span class="nt">-out</span> request.csr <span class="nt">-subj</span> <span class="s2">"/CN=DOMAIN_NAME"</span> <i class="conum" data-value="2"></i><b>(2)</b>
openssl x509 <span class="nt">-req</span> <span class="nt">-days</span> 365 <span class="nt">-in</span> request.csr <span class="nt">-signkey</span> private.key <span class="nt">-out</span> certificate.crt <i class="conum" data-value="3"></i><b>(3)</b>
openssl dhparam <span class="nt">-out</span> dhparam.pem 4096 <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generiert einen 4096 byte langen private key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Generiert eine Certifacet Signing Request (Zertifikt Unterschreibungs Anfrage)<br>
DOMAIN_NAME sollte mit der tatsächlichen Domain ausgetauscht werden.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Generiert das tatsächliche Zertifikat welches für <strong>365</strong> Tage gültig ist.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Generiert eine 4096 byte lange Diffi-Hellman Parameter für den sicheren Schlüsselaustausch</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_suppa_wie_benutzt_ich_das_jetzt"><a class="anchor" href="#_suppa_wie_benutzt_ich_das_jetzt"></a>8.4.2. Suppa. Wie benutzt ich das jetzt?</h4>
<div class="listingblock">
<div class="title">conf.d/reverse-proxy.conf</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="conf"><span class="n">ssl_certificate</span> /<span class="n">etc</span>/<span class="n">ssl</span>/<span class="n">certificate</span>.<span class="n">crt</span>;
<span class="n">ssl_certificate_key</span> /<span class="n">etc</span>/<span class="n">ssl</span>/<span class="n">private</span>.<span class="n">key</span>;
<span class="n">ssl_dhparam</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">dhparam</span>.<span class="n">pem</span>;
<span class="n">ssl_protocols</span> <span class="n">TLSv1</span>.<span class="m">3</span>;

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">443</span> <span class="n">ssl</span>;

    <span class="n">server_name</span> <span class="n">localhost</span>;

    <span class="n">location</span> /<span class="n">some</span>-<span class="n">path</span>/ {
        <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">http_host</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Real</span>-<span class="n">IP</span> $<span class="n">remote_addr</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>;

        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">nginx</span>-<span class="n">echo</span>:<span class="m">8080</span>/;
    }
}

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">443</span> <span class="n">ssl</span>;

    <span class="n">server_name</span> <span class="n">echo</span>.<span class="n">localhost</span>;

    <span class="n">location</span> / {
        <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">http_host</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Real</span>-<span class="n">IP</span> $<span class="n">remote_addr</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
        <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">Proto</span> $<span class="n">scheme</span>;

        <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">nginx</span>-<span class="n">echo</span>:<span class="m">8080</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So schwer war des jetzt ned. Wenn man im Browser jetzt <strong>https</strong>://echo.localhost aufruft wird man von dieser wunderschönen Warnung begrüßt.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/self-signed-warning.png" alt="self signed warning"></span></p>
</div>
<div class="paragraph">
<p>Was kann man dagegen tun? Nichts. Außer man benutzt Zertifikate die von sogenanten "Certifcate Authorities" ausgestellt werden.<br>
Dafür braucht man eine Öffentliche Domain, welche auf den Server zeigt, auf den der Reverse Proxy läuft.</p>
</div>
<div class="paragraph">
<p>Ein selbstsigniertes Zertifikat bedeutet, dass der Server selbst behauptet, seine Identität und Inhalte seien vertrauenswürdig.<br>
Es ist geeignet für Development Zwecke oder in internen Netzwerken, wenn keine CA die validität versichern kann.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/trust-me-bro.jpg" alt="trust me bro"></span></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quellen"><a class="anchor" href="#_quellen"></a>9. Quellen</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Keycloak - Identity and Access Management for Modern Applications (Second Edition)</p>
</li>
<li>
<p><a href="https://quarkus.io/guides/security-keycloak-admin-client" class="bare">https://quarkus.io/guides/security-keycloak-admin-client</a></p>
</li>
<li>
<p><a href="https://www.okta.com/de/identity-101/whats-the-difference-between-oauth-openid-connect-and-saml/" class="bare">https://www.okta.com/de/identity-101/whats-the-difference-between-oauth-openid-connect-and-saml/</a></p>
</li>
<li>
<p><a href="https://www.microsoft.com/de-de/security/business/security-101/what-is-oauth" class="bare">https://www.microsoft.com/de-de/security/business/security-101/what-is-oauth</a></p>
</li>
<li>
<p><a href="https://auth0.com/de/intro-to-iam/what-is-oauth-2" class="bare">https://auth0.com/de/intro-to-iam/what-is-oauth-2</a></p>
</li>
<li>
<p><a href="https://auth0.com/de/intro-to-iam/what-is-openid-connect-oidc" class="bare">https://auth0.com/de/intro-to-iam/what-is-openid-connect-oidc</a></p>
</li>
<li>
<p><a href="https://auth0.com/de/intro-to-iam/what-is-saml" class="bare">https://auth0.com/de/intro-to-iam/what-is-saml</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/" class="bare">https://www.keycloak.org/</a></p>
</li>
<li>
<p><a href="https://goauthentik.io/" class="bare">https://goauthentik.io/</a></p>
</li>
<li>
<p><a href="https://jwt.io/" class="bare">https://jwt.io/</a></p>
</li>
<li>
<p><a href="https://medium.com/@nishada/securing-a-javascript-app-using-keycloak-263fdbbc9d02" class="bare">https://medium.com/@nishada/securing-a-javascript-app-using-keycloak-263fdbbc9d02</a></p>
</li>
<li>
<p><a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1" class="bare">https://datatracker.ietf.org/doc/html/rfc7519#section-4.1</a></p>
</li>
<li>
<p><a href="https://traefik.io/glossary/reverse-proxy/" class="bare">https://traefik.io/glossary/reverse-proxy/</a> (a bissl marketing halluzinationen oba is ned so schlecht)</p>
</li>
<li>
<p><a href="https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/" class="bare">https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/</a></p>
</li>
<li>
<p><a href="https://stytch.com/blog/jwt-claims/" class="bare">https://stytch.com/blog/jwt-claims/</a></p>
</li>
<li>
<p><a href="https://www.keycloak.org/docs/latest/server_development" class="bare">https://www.keycloak.org/docs/latest/server_development</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2024-12-16 22:55:22 UTC
</div>
</div>
</body>
</html>